---
layout: 12pt,review
linenumbers: true
title: "Do we need detailed demographic data to forecast plant population responses to climate change?"
author: 
  - name: Andrew T. Tredennick
    affiliation: usu
    email: atredenn(at)gmail.com
    footnote: Corresponding author
  - name: Peter B. Adler
    affiliation: usu
address: 
  - code: usu
    address: | 
      Department of Wildland Resources and the Ecology Center, 
      Utah State University,
      Logan, UT 84322, USA
abstract: |
  Forecasts of populations under future climate change are constrained by the spatial and temporal scales at which we can gather data. For plants, ecologists often require individual level data to build population models; data that is difficult and expensive to collect at spatial scales greater than one square meter. Models built using such data are difficult to scale-up to spatial scales relevant to land management decisions and policy intervention. A possible route forward are density-structured models based on coarse-scale census data, which are much easier to collect over large spatial extents. However, to use coarse-scale data in a climate change context requires the assumption that the climate signals in population dynamics identified using individual-level data can also be identified when individual-level data are averaged over. Here we use a longterm dataset to model population dynamics using individual-level and plot-level data.   

keywords:
  - ecological forecasts
  - population models
  - integral projection model
  - climate change
  - grassland

bibliography: components/references.bib
csl: components/ecology.csl
documentclass: components/elsarticle

## rmarkdown render options
output:
  pdf_document:
    fig_caption: true
    template: components/elsarticle.latex
    keep_tex: true

---

```{r caching, include=FALSE}
library("methods")
library("knitr")
basename <- "manuscript"
opts_chunk$set(fig.path = paste("components/figure/", basename, "-", sep=""),
               cache.path = paste("components/cache/", basename, "/", sep=""))
opts_chunk$set(cache = 2)
opts_chunk$set(tidy=FALSE, warning=FALSE, message=FALSE, 
               comment = NA, verbose = TRUE, echo=FALSE)

# PDF-based figures
opts_chunk$set(dev='pdf')
```


```{r plot-options, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", 
               "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

opts_chunk$set(dev='pdf', dev.args=c(version="1.3"))

```

Introduction
============
Producing skillfull forecasts at spatial scales relevant to global environmental changes that play out at the landscape and regional scale has proven challenging for population ecologists. The major hurdle is that most population models, at least for plant species, are built using data from small, localized plots because parameterizing vital rate regressions requires tracking the fates of individuals. These models are difficult to scale up from the micro to meso-scales because the fitted parameters do not fully represent the spatial variation present at spatial scales beyond that at which the data are collected. 

Recently, Freckelton et al., building on work by Hastings and NAME, have proposed density-structured population models that focus on the transition of populations among discrete states, rather than the traditional approach of modeling the transitions of individuals. Such an approach could be extremely valuable because the data needed to parameterize density-structured population models is much easier, and less costly, to collect (Queenborough et al. year). For example, using a density-structured approach, one could build a population model using a time series of annual plot-based censuses of species percent cover. However, a major assumption of the density-structured approach is that the aggregate dynamics of the population observed at coarse spatial resolution faithfully represent, and correspond to, the fates of individual plants. In other words, using a density-structured approach requires a leap of faith that important covariates (e.g., climate variables) at the level of the individual are captured adequately at the population level. If we seek to forecast the impacts of climate change on plant populations, then clearly this assumption requires testing.

Materials and Methods
=====================
### Study site and data
Our demographic data comes from the Fort Keogh Livestock and Range Research Laboratory in eastern Montana's northern mixed prairie near Miles City, Montana, USA (46 deg. 19' N, 105 deg 48' W). The dataset is freely available on Ecological Archives (CITE), and interested readers should refer to the metadata therin for a complete description. The site is about 800 m above sea level and mean annual precipitation (1878-2009) is 334 mm, with most annual precipitaion falling from April through September (76). The site is grass dominated and, for the purposes of our study, we focus on the four most abundant graminoid species: \emph{Bouteloua gracilis}, \emph{Hesperostipa comata}, \emph{Pascopyrum smithii}, and \emph{Poa secunda}. 

From 1932 to 1945 individual plants were identified and mapped annualy in 44 1-m2 quadrats using a pantograph. The quadrats were distributed in six pastures, each assigned a grazing treatment of light (1.24 ha/animal unit month), moderate (0.92 ha/aum), and heavy (0.76 ha/aum) stocking rates (two pastures per treatment). In this analysis we account for potential differences among the grazing treatments, but do not focus on grazing$\times$climate interactions. The annual maps of the quadrats were digitized and the fates of individual plants tracked and extracted using a computer program. Daily climate data, which we aggregated into climate variables of interest, are available for the duration of the data collection period (1932 - 1945) from the Miles City airport, Wiley Field, 9 km from the study site.

### Stastical models of vital rates
The first step in building our single-species population models was to fit statistical models of vital rates at both levels of inference: individual-level and quadrat-level. Here we describe the general statistical approach at the individual-level, but the same approach applies at the quadrat-level. We modeled survival and growth as functions of genet size (quadrat cover in the quadrat-level models) and climate covariates (described in more detail below). We maintained a consistent random effects structure for both models that included three terms: (1) a random year effect on the intercept, (2) a random year effect on the coefficient for plant cover (either individual or quadrat level), and (3) a random effect of group (see Data set description) on the intercept. Vital rates for each species are modeled separately.

We used logistic regression to model survival probability:

\begin{equation}
logit(s) = \beta_{0,t} + \beta_{s,t}x + \beta_{Q} + \beta_{c,1}\theta_{1,t}\\
+ \cdots +  \beta_{c,i}\theta_{i,t} + \varepsilon_{t}
\end{equation}

where $x$ is the log of genet size (quadrat areal cover), $\beta_{0,t}$ is a year-specific intercept, $\beta_{s,t}$ is the year-specific slope parameter for size, $\beta_{Q}$ is the random effect of quadrat group location, $\theta$ is a matrix of $i$ climate effects over $t$ years, $\beta_{c,i}$ is the fixed parameter for the effect of the $i$th climate covariate, and $\varepsilon_{t}$ is the error term. At the quadrat level we did not fit random year effects for survival because those parameters did not reach convergence (see "Computing").

We modeled growth as gaussian process describing genet size (or quadrat cover) at time $t+1$ as a function of size at $t$ and climate covariates:

\begin{equation}
x_{t+1} = \beta_{0,t} + \beta_{s,t}x_{t} + \beta_{Q} + \beta_{c,1}\theta_{1,t}\\
+ \cdots +  \beta_{c,i}\theta_{i,t} + \varepsilon_{t}
\end{equation}

where $x$ is genet size and all other paramters are as described for the survival regression. For the quadrat-level approach we modeled growth as a process describing proportional cover within a quadrat at time $t+1$ as a function of proportional cover at time $t$ and climate covariates. Thus, instead of a gaussian process, with a normal likelihood, we modeled growth at the quadrat level as above but with a beta likelihood and a logit link to the linear predictors.  

While our approach for modeling survival and growth is similar at the individual and quadrat levels, the addition of new genets at the inidividual level or occupied sites at the quadrat level requires two separate approaches.

### Including climate covariates (and avoiding model selection)
For both the individual-level IPM (IPM) and the quadrat-based IBM (QBM) we included four climate covariates in each vital rate regression: fall through spring precipitation at \emph{t}-1 and \emph{t}-2 (ppt1 and ppt2, respectively) and mean spring temperature at \emph{t}-1 and \emph{t}-2 (TmeanSpr1 and TmeanSpr2, respectively), where \emph{t} is the observation year. We included climate covariates as additive effects. We did not consider interactions among climate covariates or among climate covariates and plant size or proportional cover. Climate effects ($\beta_{c}$s) were modeled hierarchically in each vital rate regression so that each species specific climate effect is drawn from an interspecific climate effect distribution. This was necessary to achieve convergence at the quadrat level and we used the same approach at the individual level for uniformity.

### Model fitting
All of our analyses (model fitting and simulating) were conducted in Program R. We used the MCMC sampler in JAGS to estimate the posterior distributions of model parameters. We obtained posterior distributions for all model parameters from three parallel MCMC chains run for 50,000 iterations, after a 50,000 iteration burn in. We assessed convergence visually and using the Gelman diagnostic in the R package `coda.' Scale reduction factors for all parameters were less than 1.02, indicating convergence. For the purposes of introducing stochasticity in our population models, we saved the final 1,000 iterations from each chain for all parameters to be used as randomly drawn values during population simulation.

### Population models
With the posterior distribution of the vital rate statistical models in hand, it is straightforward to simulate the population models. 

Results
=======
We assessed the statistical importance of the climate covariates included the final vital rate regressions by comparing the residual deviance of models with climate covariates and temporal random effects, climate covariates only, and temporal random effects only. When a model includes climate covariates, this comparison shows the relative contribution of the climate covariates in explaining the total interannual variability (Adler et al. 2012). 

```{r figure_1, dependson="plot-options", fig.cap="The proportion of interannual variability in  vital rates explained by the climate covariates. The contribution for growth is defined as: (Climate model - Constant Model)/(Full model - Constant model). The contribution for survival and colonization, where we could not estimate a full model with year random effects at the quadrat level, is defined as: (Constant Model - Climate Model)/Constant Model.", fig.width=7, fig.height=3, cache=FALSE, results='hide'}
deviance <- data.frame(VitalRate = c("Growth", "Survival", "Colonization"),
                       ConstantModel = rep(NA,3),
                       ClimateModel = rep(NA,3),
                       FullModel = rep(NA,3),
                       ClimateContribution = rep(NA,3))
deviance$FullModel[1] <- round(read.csv("../montana/quadBM/vitalRateRegressions/growth/growthDeviance.csv")[,2],2)
deviance$ClimateModel[1] <- round(read.csv("../montana/quadBM/vitalRateRegressions/growth/growthDevianceCLIMATE.csv")[,2],2)
deviance$ConstantModel[1] <- round(read.csv("../montana/quadBM/vitalRateRegressions/growth/growthDevianceCONSTANT.csv")[,2],2)
deviance$ClimateContribution[1] <- with(deviance[1,], (ClimateModel-ConstantModel)/(FullModel-ConstantModel))
deviance$ClimateModel[2] <- round(read.csv("../montana/quadBM/vitalRateRegressions/survival/survivalDeviance.csv")[,2],2)
deviance$ConstantModel[2] <- round(read.csv("../montana/quadBM/vitalRateRegressions/survival/survivalDevianceCONSTANT.csv")[,2],2)
deviance$ClimateModel[3] <- round(read.csv("../montana/quadBM/vitalRateRegressions/colonization/colonizationDeviance.csv")[,2],2)
deviance$ConstantModel[3] <- round(read.csv("../montana/quadBM/vitalRateRegressions/colonization/colonizationDevianceCONSTANT.csv")[,2],2)
deviance$ClimateContribution[2:3] <- with(deviance[2:3,], (ConstantModel-ClimateModel)/(ConstantModel))

colnames(deviance) <- c("Vital Rate", "Constant model", "Climate model", "Full model", "Contribution of climate covariates")
library(ggplot2)
devGQ <- data.frame(VitalRate = c("Growth", "Survival", "Colonization"),
                       ConstantModel = rep(NA,3),
                       ClimateModel = rep(NA,3),
                       FullModel = rep(NA,3),
                       ClimateContribution = rep(NA,3))
devGQ$FullModel[1] <- round(read.csv("../montana/ipm/vitalRateRegs/growth/growthDeviance.csv")[,2],2)
devGQ$ClimateModel[1] <- round(read.csv("../montana/ipm/vitalRateRegs/growth/growthDevianceCLIMATE.csv")[,2],2)
devGQ$ConstantModel[1] <- round(read.csv("../montana/ipm/vitalRateRegs/growth/growthDevianceCONSTANT.csv")[,2],2)
devGQ$FullModel[2] <- round(read.csv("../montana/ipm/vitalRateRegs/survival/survivalDeviance.csv")[,2],2)
devGQ$ClimateModel[2] <- round(read.csv("../montana/ipm/vitalRateRegs/survival/survivalDevianceCLIMATE.csv")[,2],2)
devGQ$ConstantModel[2] <- round(read.csv("../montana/ipm/vitalRateRegs/survival/survivalDevianceCONSTANT.csv")[,2],2)
devGQ$FullModel[3] <- round(read.csv("../montana/ipm/vitalRateRegs/recruitment/recruitmentDeviance.csv")[,2],2)
devGQ$ClimateModel[3] <- round(read.csv("../montana/ipm/vitalRateRegs/recruitment/recruitmentDevianceCLIMATE.csv")[,2],2)
devGQ$ConstantModel[3] <- round(read.csv("../montana/ipm/vitalRateRegs/recruitment/recruitmentDevianceCONSTANT.csv")[,2],2)
devGQ$ClimateContribution[1] <- with(devGQ[1,], (ClimateModel-ConstantModel)/(FullModel-ConstantModel))
devGQ$ClimateContribution[2] <- with(devGQ[2,], (ConstantModel-ClimateModel)/(ConstantModel))
devGQ$ClimateContribution[3] <- with(devGQ[3,], (ConstantModel-ClimateModel)/(ConstantModel))

devM <- devGQ[,c(1,5)]
devM$Level <- rep("Individual", 3)
tmpD <- deviance[,c(1,5)]
tmpD$Level <- rep("Quadrat", 3)
colnames(tmpD)[2] <- "value"
colnames(tmpD)[1] <- "VitalRate"
colnames(devM)[2] <- "value"
plotD <- rbind(tmpD, devM)
gClimCont1 <- ggplot(data=subset(plotD, Level=="Individual"), aes(x=VitalRate, y=value))+
  geom_bar(stat="identity", position="dodge", fill="grey30")+
  ylab("Contribution of Climate Effects")+
  xlab("Vital Rate")+
  ggtitle("Individual level")+
  scale_y_continuous(limits=c(0, 0.5))+
  scale_x_discrete(labels=c("Recruitment", "Growth", "Survival"))+
  theme_bw()+
  theme(axis.text.x = element_text(angle = 25, hjust = 1))
gClimCont2 <- ggplot(data=subset(plotD, Level=="Quadrat"), aes(x=VitalRate, y=value))+
  geom_bar(stat="identity", position="dodge", fill="grey30")+
  ylab("Contribution of Climate Effects")+
  xlab("Vital Rate")+
  ggtitle("Quadrat level")+
  scale_y_continuous(limits=c(0, 0.5))+
  scale_x_discrete(labels=c("Colonization", "Cover change", "Extirpation"))+
  theme_bw()+
  theme(axis.text.x = element_text(angle = 25, hjust = 1))
library(gridExtra)
gClim <- grid.arrange(gClimCont1, gClimCont2, ncol=2, nrow=1)
gClim

```

